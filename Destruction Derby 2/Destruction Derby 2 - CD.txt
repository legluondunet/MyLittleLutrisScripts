files:
- game_cd:
    filename: Destruction-Derby-2_Win_EN_ISO-Version.zip
    url: https://d1.xp.myabandonware.com/t/94f71d1d-f276-4cd2-aacb-743da73b9d22/Destruction-Derby-2_Win_EN_ISO-Version.zip
- wrapper1: https://github.com/legluondunet/mlls-tools/raw/refs/heads/master/dgVoodoo2/dgVoodoo2_79_3.zip
- wrapper2: https://github.com/legluondunet/mlls-tools/raw/master/CDAudio%20proxy%20/cdaemu.v2.05.58_build.rar
- cd-tools: https://github.com/legluondunet/mlls-tools/raw/refs/heads/master/cdrtools/cdrtools.zip
- game_patch: https://github.com/legluondunet/MyLittleLutrisScripts/raw/refs/heads/master/Destruction%20Derby%202/dd2_patchs.zip
game:
  exe: drive_c/Program Files/Games/DD2/dd2h.exe
  prefix: $GAMEDIR
installer:
- task:
    name: create_prefix
    prefix: $GAMEDIR
- extract:
    dst: $CACHE
    file: game_cd
    format: zip
- extract:
    dst: $CACHE
    file: cd-tools
    format: zip
- execute:
    command: cd "$CACHE" ; mkdir music; ./bchunk -w "DD2_PC.bin" "DD2_PC.cue" "track"
      ; mv *.wav music;
- extract:
    dst: $CACHE/CD
    file: $CACHE/track01.iso
    format: iso
- task:
    executable: $CACHE/CD/INSTALL.EXE
    name: wineexec
    return_code: 8448
- merge:
    dst: $GAMEDIR/drive_c/Program Files/Games/DD2_backup
    src: $GAMEDIR/drive_c/Program Files/Games/DD2
- extract:
    dst: $GAMEDIR/drive_c/Program Files/Games/DD2
    file: game_patch
    format: zip
- merge:
    dst: $GAMEDIR/drive_c/Program Files/Games/DD2/music
    src: $CACHE/music
- extract:
    dst: $CACHE
    file: wrapper1
    format: zip
- merge:
    dst: $GAMEDIR/drive_c/Program Files/Games/DD2
    src: $CACHE/MS/x86/D3DImm.dll
- merge:
    dst: $GAMEDIR/drive_c/Program Files/Games/DD2
    src: $CACHE/MS/x86/DDraw.dll
- write_config:
    data:
      DirectX:
        dgVoodooWatermark: false
      GeneralExt:
        FPSLimit: 30
    file: $GAMEDIR/drive_c/Program Files/Games/DD2/dgVoodoo.conf
- extract:
    dst: $GAMEDIR/drive_c/Program Files/Games/DD2
    file: wrapper2
    format: rar
wine:
  overrides:
    ddraw: n,b
    winmm: n,b
